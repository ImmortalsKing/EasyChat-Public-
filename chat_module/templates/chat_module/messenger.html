{% extends 'shared/_messenger_layout.html' %}
{% load static %}
{% load thumbnail %}
{% load render_partial %}
{% load poll_extras %}

{% block title %}Chat Page{% endblock %}
{% block header_references %}
    {% if '/chat/' in request.path %}
        <meta name="websocket-url" content="wss://easychatz.ir/websocket/chat/{{ person.id }}">
        {#                <meta name="websocket-url" content="ws://localhost:8000/websocket/chat/{{ person.id }}">#}
    {% elif '/group-chat/' in request.path %}
        <meta name="websocket-url" content="wss://easychatz.ir/websocket/group-chat/{{ group.slug }}">
{#                        <meta name="websocket-url" content="ws://localhost:8000/websocket/group-chat/{{ group.slug }}">#}
    {% endif %}
    {% if '/chat/' in request.path %}
        <meta name="my-avatar" content="{{ me.avatar.url }}">
    {% elif '/group-chat/' in request.path %}
        <meta name="my-avatar" content="{{ sender.avatar.url }}">
    {% endif %}
    {% if '/chat/' in request.path %}
        <meta name="person-id" content="{{ person.id }}">
    {% elif '/group-chat/' in request.path %}
        <meta name="person-id" content="{{ sender.id }}">
    {% endif %}
    <meta name="group-slug" content="{{ group.slug }}">
    <meta name="is_superuser" content="{{ me.is_superuser }}">
    <link rel="stylesheet" href="{% static 'lib/css/lightbox.css' %}">
{% endblock %}

{% block content %}
    <div class="chitchat-container sidebar-toggle mobile-menu">
        {% render_partial 'chat_module.views.SidebarComponent' %}
        <div class="chitchat-main small-sidebar" id="content">
            <div class="chat-content tabto active">
                <div class="messages custom-scroll {% if request.path|match_chat_url %}active{% endif %}" id="chating">
                    <div class="contact-details">
                        <div class="row">
                            <div class="col-7">
                                <div class="media left">
                                    <div class="media-left mr-3">
                                        <div class="profile"><img class="bg-img"
                                                                  src="{{ person.avatar.url }}"
                                                                  alt="Avatar"/></div>
                                    </div>
                                    <div class="media-body">
                                        <h5 style="padding-top: 10px;">{{ person.display_name }}</h5>
                                    </div>
                                    <div class="media-right">
                                        <ul>
                                            <li></li>
                                            <li></li>
                                            <li><a class="icon-btn btn-light button-effect mobile-sidebar" href="#">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                     class="feather feather-chevron-left">
                                                    <polyline points="15 18 9 12 15 6"></polyline>
                                                </svg>
                                            </a></li>
                                        </ul>
                                        {#                                        <ul>#}
                                        {#                                            <li><a class="icon-btn btn-light button-effect mobile-sidebar" href="#">#}
                                        {#                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"#}
                                        {#                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"#}
                                        {#                                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"#}
                                        {#                                                     class="feather feather-chevron-left">#}
                                        {#                                                    <polyline points="15 18 9 12 15 6"></polyline>#}
                                        {#                                                </svg>#}
                                        {#                                            </a></li>#}
                                        {#                                        </ul>#}
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <ul class="calls text-right">
                                    <li class="chat-friend-toggle"><a
                                            class="icon-btn btn-light bg-transparent button-effect outside" href="#"
                                            data-tippy-content="Quick action">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                             stroke-linecap="round" stroke-linejoin="round"
                                             class="feather feather-more-vertical">
                                            <circle cx="12" cy="12" r="1"></circle>
                                            <circle cx="12" cy="5" r="1"></circle>
                                            <circle cx="12" cy="19" r="1"></circle>
                                        </svg>
                                    </a>
                                        <div class="chat-frind-content" style="display: none;">
                                            <ul>
                                                <li><a class="profile-link icon-btn btn-outline-primary btn-sm"
                                                       href="#" data-id="{{ person.id }}"
                                                       data-avatar="{{ person.avatar.url }}"
                                                       data-display-name="{{ person.display_name }}"
                                                       data-about-me="{{ person.about_user }}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                         viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                         class="feather feather-user">
                                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                        <circle cx="12" cy="7" r="4"></circle>
                                                    </svg>
                                                </a>
                                                    <h5>Profile</h5>
                                                </li>
                                                {% if request.user.is_superuser and person.is_blocked %}
                                                    <li>
                                                        <form action="" method="post"
                                                              style="display: contents; margin: 0; padding: 0;">
                                                            {% csrf_token %}
                                                            <button style="position:absolute;left:0;cursor: pointer;"
                                                                    class="icon-btn btn-outline-light btn-sm"
                                                                    type="submit" name="unblock_user">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="16"
                                                                     height="16" fill="currentColor"
                                                                     class="bi bi-repeat" viewBox="0 0 16 16">
                                                                    <path d="M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"/>
                                                                </svg>
                                                            </button>
                                                        </form>
                                                        <h5>Unlock</h5>
                                                    </li>
                                                {% elif request.user.is_superuser %}
                                                    <li>
                                                        <form action="" method="post"
                                                              style="display: contents; margin: 0; padding: 0;">
                                                            {% csrf_token %}
                                                            <button style="position:absolute;left:0;cursor: pointer;"
                                                                    class="icon-btn btn-outline-light btn-sm"
                                                                    type="submit" id="block_user" name="block_user">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                     height="24"
                                                                     viewBox="0 0 24 24" fill="none"
                                                                     stroke="currentColor"
                                                                     stroke-width="2" stroke-linecap="round"
                                                                     stroke-linejoin="round"
                                                                     class="feather feather-slash">
                                                                    <circle cx="12" cy="12" r="10"></circle>
                                                                    <line x1="4.93" y1="4.93" x2="19.07"
                                                                          y2="19.07"></line>
                                                                </svg>
                                                            </button>
                                                        </form>
                                                        <h5>Block</h5>
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="contact-chat">
                        <ul id="message_area" class="chatappend">
                            {% for message in chat_messages %}
                                {% if message.from_who == me %}
                                    <li class="replies">
                                        <div class="media">
                                            <div class="profile mr-4 bg-size"
                                                 style="background-image: url('{{ me.avatar.url }}'); background-size: cover; background-position: center center; display: block;">
                                                <img class="bg-img" src="{{ me.avatar.url }}" alt="Avatar"
                                                     style="display: none;"></div>
                                            <div class="media-body">
                                                <div class="contact-name">
                                                    <h5>Me</h5>
                                                    <h6>{{ message.date }}, {{ message.time }}</h6>
                                                    <ul class="msg-box">
                                                        <li class="msg-setting-main">
                                                            {% if message.image %}
                                                                <a href="{{ message.image.url }}"
                                                                   data-lightbox="image-{{ message.id }}">
                                                                    <img src="{{ message.image.url }}"
                                                                         style="max-width: 100%;">
                                                                </a>
                                                            {% elif message.file %}
                                                                <a href="{{ message.file_url }}"
                                                                   download="{{ message.file_name }}">
                                                                    <button class="btn btn-success">
                                                                        Download {{ message.file_name|truncatechars:10 }}</button>
                                                                </a>
                                                            {% else %}
                                                                <h5 id='message-text-{{ message.id }}'
                                                                    class="rtl">{{ message.message }}</h5>
                                                            {% endif %}
                                                            {% if message.has_been_seen %}
                                                                <div class="seen-status badge badge-success sm ml-2">R
                                                                </div>
                                                            {% else %}
                                                                <div class="seen-status"></div>
                                                            {% endif %}
                                                            <div class="msg-dropdown-main">
                                                                <div class="msg-setting"><i class="ti-more-alt"></i>
                                                                </div>
                                                                <div class="msg-dropdown">
                                                                    <ul>
                                                                        {% if me.is_superuser %}
                                                                            <li>
                                                                                <form action="" method="post">
                                                                                    {% csrf_token %}
                                                                                    <input type="hidden"
                                                                                           name="message_id"
                                                                                           value="{{ message.id }}">
                                                                                    <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                            type="submit"
                                                                                            name="message_delete">
                                                                                        <i style="font-size:16px;margin-right:8px"
                                                                                           class="ti-trash"></i>
                                                                                        delete
                                                                                    </button>
                                                                                </form>
                                                                            </li>
                                                                        {% endif %}
                                                                        <li>
                                                                            <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                    onclick="copyToClipboard({{ message.id }})">
                                                                                <i style="font-size:16px;margin-right:8px"
                                                                                   class="ti-clipboard"></i>copy
                                                                            </button>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                {% elif message.from_who == person %}
                                    <li class="sent">
                                        <div class="media">
                                            <div class="profile mr-4 bg-size"
                                                 style="background-image: url('{{ person.avatar.url }}'); background-size: cover; background-position: center center; display: block;">
                                                <img class="bg-img" src="{{ person.avatar.url }}" alt="Avatar"
                                                     style="display: none;"></div>
                                            <div class="media-body">
                                                <div class="contact-name">
                                                    <h5>{{ person.display_name }}</h5>
                                                    <h6>{{ message.date }},</h6>
                                                    <h6>{{ message.time }}</h6>
                                                    <ul class="msg-box">
                                                        <li class="msg-setting-main">
                                                            {% if message.image %}
                                                                <a href="{{ message.image.url }}"
                                                                   data-lightbox="image-{{ message.id }}">
                                                                    <img src="{{ message.image.url }}"
                                                                         style="max-width: 100%;">
                                                                </a>
                                                            {% elif message.file %}
                                                                <a href="{{ message.file_url }}"
                                                                   download="{{ message.file_name }}">
                                                                    <button class="btn btn-primary">
                                                                        Download {{ message.file_name|truncatechars:10 }}</button>
                                                                </a>
                                                            {% else %}
                                                                <h5 id="message-text-{{ message.id }}"
                                                                    class="rtl">{{ message.message }}</h5>
                                                            {% endif %}
                                                            <div class="msg-dropdown-main">
                                                                <div class="msg-setting"><i class="ti-more-alt"></i>
                                                                </div>
                                                                <div class="msg-dropdown">
                                                                    <ul>
                                                                        {% if me.is_superuser %}
                                                                            <li>
                                                                                <form action="" method="post">
                                                                                    {% csrf_token %}
                                                                                    <input type="hidden"
                                                                                           name="message_id"
                                                                                           value="{{ message.id }}">
                                                                                    <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                            type="submit"
                                                                                            name="message_delete">
                                                                                        <i style="font-size:16px;margin-right:8px"
                                                                                           class="ti-trash"></i>
                                                                                        delete
                                                                                    </button>
                                                                                </form>
                                                                            </li>
                                                                        {% endif %}
                                                                        <li>
                                                                            <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                    onclick="copyToClipboard({{ message.id }})">
                                                                                <i style="font-size:16px;margin-right:8px"
                                                                                   class="ti-clipboard"></i>copy
                                                                            </button>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}

                        </ul>
                    </div>
                </div>
                <div class="messages custom-scroll" id="blank">
                    <div class="contact-details">
                        <div class="row">
                            <div class="col-7">
                                <div class="media-right">
                                    <ul>
                                        <li><a class="icon-btn btn-light button-effect mobile-sidebar" href="#">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                 stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                 class="feather feather-chevron-left">
                                                <polyline points="15 18 9 12 15 6"></polyline>
                                            </svg>
                                        </a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="contact-chat">
                        <div class="rightchat animat-rate">
                            <div class="bg_circle">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="cross"></div>
                            <div class="cross1"></div>
                            <div class="cross2"></div>
                            <div class="dot"></div>
                            <div class="dot1"></div>
                        </div>
                    </div>
                    <div class="call-list-center"><img src="{% static 'images/chat.png' %}" alt="">
                        <div class="animated-bg"><i></i><i></i><i></i></div>
                        <p>Select a chat to read messages</p>
                    </div>
                </div>
                <div class="messages custom-scroll {% if '/group-chat/' in request.path %}active{% endif %}"
                     id="group_chat">
                    <div class="contact-details">
                        <div class="row">
                            <div class="col">
                                <div class="media left">
                                    <div class="media-left mr-3">
                                        <div class="profile menu-trigger bg-size"
                                             style="background-image: url('{{ group.avatar.url }}'); background-size: cover; background-position: center center; display: block;">
                                            <img class="bg-img" src="{{ group.avatar.url }}" alt="Avatar"
                                                 style="display: none;"></div>
                                    </div>
                                    <div class="media-body">
                                        <h5 style="padding-top: 10px;">{{ group.title }}</h5>
                                    </div>
                                    <div class="media-right">
                                        <ul>
                                            <li></li>
                                            <li></li>
                                            <li><a class="icon-btn btn-light button-effect mobile-sidebar" href="#">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                     class="feather feather-chevron-left">
                                                    <polyline points="15 18 9 12 15 6"></polyline>
                                                </svg>
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            {% if request.user.is_superuser %}
                                <div class="col">
                                    <ul class="calls text-right">
                                        <li class="chat-friend-toggle"><a
                                                class="icon-btn btn-light bg-transparent button-effect outside" href="#"
                                                data-tippy-content="Quick action">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                 stroke-linecap="round" stroke-linejoin="round"
                                                 class="feather feather-more-vertical">
                                                <circle cx="12" cy="12" r="1"></circle>
                                                <circle cx="12" cy="5" r="1"></circle>
                                                <circle cx="12" cy="19" r="1"></circle>
                                            </svg>
                                        </a>
                                            <div class="chat-frind-content" style="display: none;">
                                                <ul>
                                                    <li>
                                                        <form action="" method="post"
                                                              style="display: contents; margin: 0; padding: 0;">
                                                            {% csrf_token %}
                                                            <button style="position:absolute;left:0;cursor: pointer;"
                                                                    class="icon-btn btn-outline-light btn-sm"
                                                                    type="submit" name="delete_group">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="16"
                                                                     height="16" fill="currentColor" class="bi bi-trash"
                                                                     viewBox="0 0 16 16">
                                                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                                                </svg>
                                                            </button>
                                                        </form>
                                                        <h5>Delete</h5>
                                                    </li>
                                                </ul>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="contact-chat">
                        <ul id="group_message_area" class="chatappend">
                            {% if sender.is_superuser %}
                                <li class="groupuser">
                                    <h4 style="display: inline-block;">Add to / Remove from</h4><h4
                                        style="display: inline-block;margin-left: -15px">{{ group.title }}</h4>
                                    <div class="gr-chat-friend-toggle"><a
                                            class="icon-btn btn-sm pull-right add-grbtn outside" href="#"
                                            data-tippy-content="Add User">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-plus-slash-minus" viewBox="0 0 16 16">
                                            <path d="m1.854 14.854 13-13a.5.5 0 0 0-.708-.708l-13 13a.5.5 0 0 0 .708.708M4 1a.5.5 0 0 1 .5.5v2h2a.5.5 0 0 1 0 1h-2v2a.5.5 0 0 1-1 0v-2h-2a.5.5 0 0 1 0-1h2v-2A.5.5 0 0 1 4 1m5 11a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5A.5.5 0 0 1 9 12"/>
                                        </svg>
                                    </a>
                                        <div class="gr-chat-frind-content">
                                            <ul class="chat-main">
                                                {% for user in users %}
                                                    <li>
                                                        <div class="chat-box">
                                                            <div class="media">
                                                                <div class="profile bg-size"
                                                                     style="background-image: url('{{ user.avatar.url }}'); background-size: cover; background-position: center center; display: block;">
                                                                    <img class="bg-img" src="{{ user.avatar.url }}"
                                                                         alt="Avatar" style="display: none;"></div>
                                                                <div class="details">
                                                                    <h5>{{ user.display_name }}</h5>
                                                                    <h6>{{ user.invitationcode.code }}</h6>
                                                                </div>
                                                                {% if user in group.members.all %}
                                                                    <div class="media-body">
                                                                        <form action="" method="post">
                                                                            {% csrf_token %}
                                                                            <input type="hidden" name="user_id"
                                                                                   value="{{ user.id }}">
                                                                            <button type="submit" name="remove_btn"
                                                                                    class="icon-btn btn-outline-primary btn-sm">
                                                                                <i class="fa fa-minus"></i></button>
                                                                        </form>
                                                                    </div>
                                                                {% elif not user in group.members.all %}
                                                                    <div class="media-body">
                                                                        <form action="" method="post">
                                                                            {% csrf_token %}
                                                                            <input type="hidden" name="user_id"
                                                                                   value="{{ user.id }}">
                                                                            <button type="submit" name="add_btn"
                                                                                    class="icon-btn btn-outline-primary btn-sm">
                                                                                <i class="fa fa-plus"></i></button>
                                                                        </form>
                                                                    </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </li>
                                                {% endfor %}

                                            </ul>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                            {% for message in group_messages %}
                                {% if message.from_who == sender %}
                                    <li class="replies">
                                        <div class="media">
                                            <div class="profile mr-4 bg-size"
                                                 style="background-image: url('{{ sender.avatar.url }}'); background-size: cover; background-position: center center; display: block;">
                                                <img class="bg-img" src="{{ sender.avatar.url }}" alt="Avatar"
                                                     style="display: none;"></div>
                                            <div class="media-body">
                                                <div class="contact-name">
                                                    <h5>Me</h5>
                                                    <h6>{{ message.date }}, {{ message.time }}</h6>
                                                    <ul class="msg-box">
                                                        <li class="msg-setting-main">
                                                            {% if message.image %}
                                                                <a href="{{ message.image.url }}"
                                                                   data-lightbox="image-{{ message.id }}">
                                                                    <img src="{{ message.image.url }}"
                                                                         style="max-width: 100%;">
                                                                </a>
                                                            {% elif message.file %}
                                                                <a href="{{ message.file_url }}"
                                                                   download="{{ message.file_name }}">
                                                                    <button class="btn btn-success">
                                                                        Download {{ message.file_name|truncatechars:10 }}</button>
                                                                </a>
                                                            {% else %}
                                                                <h5 id="message-text-{{ message.id }}" class="rtl">{{ message.message }}</h5>
                                                            {% endif %}
                                                            {% if message.has_been_seen %}
                                                                <div class="group-seen-status badge badge-success sm ml-2">
                                                                    R
                                                                </div>
                                                            {% else %}
                                                                <div class="group-seen-status"></div>
                                                            {% endif %}
                                                            <div class="msg-dropdown-main">
                                                                <div class="msg-setting"><i class="ti-more-alt"></i>
                                                                </div>
                                                                <div class="msg-dropdown">
                                                                    <ul>
                                                                        {% if sender.is_superuser %}
                                                                            <li>
                                                                                <form action="" method="post">
                                                                                    {% csrf_token %}
                                                                                    <input type="hidden"
                                                                                           name="group_message_id"
                                                                                           value="{{ message.id }}">
                                                                                    <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                            type="submit"
                                                                                            name="group_message_delete">
                                                                                        <i style="font-size:16px;margin-right:8px"
                                                                                           class="ti-trash"></i>
                                                                                        delete
                                                                                    </button>
                                                                                </form>
                                                                            </li>
                                                                        {% endif %}
                                                                        <li>
                                                                            <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                    onclick="copyToClipboard({{ message.id }})">
                                                                                <i style="font-size:16px;margin-right:8px"
                                                                                   class="ti-clipboard"></i>copy
                                                                            </button>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                {% else %}
                                    <li class="sent">
                                        <div class="media">
                                            <div class="profile mr-4 bg-size"
                                                 style="background-image: url('{{ message.from_who.avatar.url }}'); background-size: cover; background-position: center center; display: block;">
                                                <img class="bg-img" src="{{ message.from_who.avatar.url }}" alt="Avatar"
                                                     style="display: none;"></div>
                                            <div class="media-body">
                                                <div class="contact-name">
                                                    <h5>{{ message.from_who.display_name }}</h5>
                                                    <h6>{{ message.date }}, {{ message.time }}</h6>
                                                    <ul class="msg-box">
                                                        <li class="msg-setting-main">
                                                            {% if message.image %}
                                                                <a href="{{ message.image.url }}"
                                                                   data-lightbox="image-{{ message.id }}">
                                                                    <img src="{{ message.image.url }}"
                                                                         style="max-width: 100%;">
                                                                </a>
                                                            {% elif message.file %}
                                                                <a href="{{ message.file_url }}"
                                                                   download="{{ message.file_name }}">
                                                                    <button class="btn btn-success">
                                                                        Download {{ message.file_name|truncatechars:10 }}</button>
                                                                </a>
                                                            {% else %}
                                                                <h5 id="message-text-{{ message.id }}" class="rtl">{{ message.message }}</h5>
                                                            {% endif %}
                                                                <div class="msg-dropdown-main">
                                                                    <div class="msg-setting"><i class="ti-more-alt"></i>
                                                                    </div>
                                                                    <div class="msg-dropdown">
                                                                        <ul>
                                                                            {% if sender.is_superuser %}
                                                                            <li>
                                                                                <form action="" method="post">
                                                                                    {% csrf_token %}
                                                                                    <input type="hidden"
                                                                                           name="group_message_id"
                                                                                           value="{{ message.id }}">
                                                                                    <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                            type="submit"
                                                                                            name="group_message_delete">
                                                                                        <i style="font-size:16px;margin-right:8px"
                                                                                           class="ti-trash"></i>
                                                                                        delete
                                                                                    </button>
                                                                                </form>
                                                                            </li>
                                                                                {% endif %}
                                                                            <li>
                                                                            <button style="background: none;border: none;font: inherit;color:#595959;width:100%;display: flex; align-items: center;cursor: pointer"
                                                                                    onclick="copyToClipboard({{ message.id }})">
                                                                                <i style="font-size:16px;margin-right:8px"
                                                                                   class="ti-clipboard"></i>copy
                                                                            </button>
                                                                        </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="message-input">
                    <div class="wrap emojis-main">
                        <div class="dot-btn dot-primary mr-3"><a
                                class="icon-btn btn-outline-primary button-effect toggle-emoji" href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-smile">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                <line x1="15" y1="9" x2="15.01" y2="9"></line>
                            </svg>
                        </a></div>
                        <div class="contact-poll"><a class="icon-btn btn-outline-primary mr-4 outside" href="#"><i
                                class="fa fa-plus"></i></a>
                            <div class="contact-poll-content">
                                <ul>
                                    <li><a href="#" id="upload_image_button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                             stroke-linecap="round" stroke-linejoin="round"
                                             class="feather feather-image">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                            <polyline points="21 15 16 10 5 21"></polyline>
                                        </svg>
                                        gallery</a>
                                        <input type="file" id="image_upload" style="display: none;" accept="image/*">
                                    </li>
                                    <li><a href="#" id="upload_file_button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                             stroke-linecap="round" stroke-linejoin="round"
                                             class="feather feather-clipboard">
                                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                        </svg>
                                        document</a>
                                        <input type="file" id="file_upload" style="display: none;">
                                    </li>

                                </ul>
                            </div>
                        </div>
                        <input class="setemoj rtl" id="setemoj" type="text" placeholder="Write your message...">
                        <div style="padding-left:5rem"></div>
                        {#                        <button class="icon-btn btn-primary" id="test-button">Send</button>#}
                        <button class="icon-btn btn-primary disabled" id="send_button" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-send">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                        <button id="scroll-to-bottom-btn" class="scroll-to-bottom-btn">
                            <i class="ti-arrow-down"></i>
                        </button>
                        <div class="emojis-contain">
                            <div class="emojis-sub-contain custom-scroll">
                                <ul>
                                    <li>&#128513;</li>
                                    <li>&#128512;</li>
                                    <li>&#128514;</li>
                                    <li>&#128515;</li>
                                    <li>&#128516;</li>
                                    <li>&#128517;</li>
                                    <li>&#128518;</li>
                                    <li>&#128519;</li>
                                    <li>&#128520;</li>
                                    <li>&#128521;</li>
                                    <li>&#128522;</li>
                                    <li>&#128523;</li>
                                    <li>&#128524;</li>
                                    <li>&#128525;</li>
                                    <li>&#128526;</li>
                                    <li>&#128527;</li>
                                    <li>&#128528;</li>
                                    <li>&#128529;</li>
                                    <li>&#128530;</li>
                                    <li>&#128531;</li>
                                    <li>&#128532;</li>
                                    <li>&#128533;</li>
                                    <li>&#128534;</li>
                                    <li>&#128535;</li>
                                    <li>&#128536;</li>
                                    <li>&#128537;</li>
                                    <li>&#128538;</li>
                                    <li>&#128539;</li>
                                    <li>&#128540;</li>
                                    <li>&#128541;</li>
                                    <li>&#128542;</li>
                                    <li>&#128543;</li>
                                    <li>&#128544;</li>
                                    <li>&#128545;</li>
                                    <li>&#128546;</li>
                                    <li>&#128547;</li>
                                    <li>&#128549;</li>
                                    <li>&#128550;</li>
                                    <li>&#128551;</li>
                                    <li>&#128552;</li>
                                    <li>&#128553;</li>
                                    <li>&#128554;</li>
                                    <li>&#128555;</li>
                                    <li>&#128557;</li>
                                    <li>&#128558;</li>
                                    <li>&#128559;</li>
                                    <li>&#128560;</li>
                                    <li>&#128561;</li>
                                    <li>&#128562;</li>
                                    <li>&#128563;</li>
                                    <li>&#128564;</li>
                                    <li>&#128565;</li>
                                    <li>&#128566;</li>
                                    <li>&#128567;</li>
                                    <li>&#128568;</li>
                                    <li>&#128569;</li>
                                    <li>&#128570;</li>
                                    <li>&#128571;</li>
                                    <li>&#128572;</li>
                                    <li>&#128573;</li>
                                    <li>&#128574;</li>
                                    <li>&#128576;</li>
                                    <li>&#128579;</li>
                                    <li>&#128074;</li>
                                    <li>&#128075;</li>
                                    &nbsp;
                                    <li>&#128076;</li>
                                    &nbsp;
                                    <li>&#128077;</li>
                                    &nbsp;
                                    <li>&#128078;</li>
                                    &nbsp;
                                    <li>&#128079;</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% render_partial 'chat_module.views.ContactTodoComponent' %}
        </div>
    </div>
{% endblock %}
{% block footer_references %}
    {% if '/chat/' in request.path %}
        <script src="{% static 'js/websocket.js' %}"></script>
    {% elif '/group-chat/' in request.path %}
        <script src="{% static 'js/group_websocket.js' %}"></script>
    {% endif %}
{% endblock %}